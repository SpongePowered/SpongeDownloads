<template>
  <ol class="builds">
    <li v-for="build in builds" :key="build.version" class="build" :id="build.version">
      <h4>{{ build.version }}
        <span class="build-labels"><build-label v-for="label in build.labels" :key="label.name" :l="label"/></span>
      </h4>

      <div class="artifacts">
        <b-button v-for="artifact in build.artifacts" :key="artifact.classifier"
               :variant="artifact.primary ? 'primary' : ''" :size="btnSize"
               :href="artifact.url" :title="artifact.type.title">
          <font-awesome-icon :icon="artifact.type.icon"/>
          <span> {{ artifact.primary ? 'Download' : artifact.type.name }}</span></b-button>
      </div>

      <relative-time class="build-time" :t="build.published"/>

      <div class="changelog" v-if="!primary || build.changelog">
        <commits :project="platform" :l="build.changelog"
                 v-if="build.changelog && build.changelog.length > 0"/>
        <div class="changelog-comment" v-else>
          <span v-if="build.changelog">No changes.</span>
          <span v-else>No changelog available.</span>
        </div>
      </div>

      <div class="clearfix"></div>
    </li>
  </ol>
</template>

<script>
  import {BButton} from 'bootstrap-vue';

  import {library as fontawesomeLibrary} from '@fortawesome/fontawesome-svg-core'
  import {faDownload} from '@fortawesome/free-solid-svg-icons'
  import {FontAwesomeIcon} from '@fortawesome/vue-fontawesome'

  import RelativeTime from './relative-time'
  import BuildLabel from './build-label'
  import Commits from './Commits.vue'

  fontawesomeLibrary.add(faDownload);

  export default {
    name: 'builds',
    props: {
      platform: String,
      builds: Array,
      primary: {
        type: Boolean,
        default: false
      }
    },
    computed: {
      btnSize() {
        return this.primary ? '' : 'sm'
      }
    },
    components: {
      'b-button': BButton,
      FontAwesomeIcon,
      RelativeTime,
      BuildLabel,
      Commits,
    }
  }
</script>

<style lang="scss">
  @import "../assets/variables";

  .builds {
    list-style-type: none;
    padding: 0;

    @include media-breakpoint-up(sm) {
      padding-left: 20px;
    }
  }

  .build {
    display: block;
    padding: 10px 20px;
    border-radius: 2px;

    h4 {
      font-size: 1.1em;
      float: left;
    }

    h5 {
      margin-top: 0.5rem;
      margin-left: 0.5rem;
      font-size: 1em;
    }

    &:nth-child(even) {
      background: tint($sponge_grey, 98%);
    }
  }

  .build-labels {
    * {;
      vertical-align: middle;

      // Keep some space between multiple build labels
      margin-left: 4px;

      // Reduce font size and add more padding instead
      font-size: 70%;
      padding-top: 0.3em;
      padding-bottom: 0.3em;
    }

    @include media-breakpoint-down(xs) {
      display: block;
      margin-top: 2px;
    }
  }

  .artifacts {
    float: right;
    margin-bottom: 10px;
    white-space: nowrap;
    overflow: hidden;

    .btn {
      margin-left: 2px;
    }

    @include media-breakpoint-down(sm) {
      float: left;
      clear: left;

      margin-top: 10px;
    }
  }

  .build-time {
    display: none;

    float: right;
    clear: right;

    @include montserrat;

    @include media-breakpoint-up(sm) {
      display: block;
    }
  }

</style>
